<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS · 文本转语音</title>
    <link rel="stylesheet" href="{{.BasePath}}/static/dist/css/main.css">
    <link rel="icon" type="image/svg+xml" href="{{.BasePath}}/static/icons/favicon.svg">
    <meta name="description" content="Neo-Brutalism 风格的文本转语音服务">
    <script>
        // 全局配置，由 Go 模板注入（必须在 main.js 之前）
        window.config = {
            basePath: "{{.BasePath}}",
            defaultVoice: "{{.DefaultVoice}}",
            defaultRate: "{{.DefaultRate}}",
            defaultPitch: "{{.DefaultPitch}}",
            defaultFormat: "{{.DefaultFormat}}",
            defaultStyle: ""
        };
    </script>
    <script type="module" src="{{.BasePath}}/static/dist/js/main.js"></script>
</head>

<body class="min-h-screen bg-white text-black">
    <div class="max-w-7xl mx-auto px-6 py-8">

        <!-- 标题区域 -->
        <header class="text-center mb-12">
            <div class="inline-block bg-brut-yellow border-3 border-black rounded-none px-8 py-4 shadow-brut mb-6">
                <h1 class="text-5xl font-black uppercase tracking-tight">
                    TTS 语音合成
                </h1>
            </div>
            <p class="text-lg font-bold max-w-2xl mx-auto">
                将文本转化为自然人声 · 支持多种声音与情感风格
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- 左侧：输入区域 -->
            <div class="lg:col-span-2">
                <div class="brut-panel">
                    <!-- 输入模式切换 -->
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="brut-text-heading text-2xl">输入内容</h2>
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-bold uppercase">模式:</span>
                            <button id="toggleInputMode" class="brut-btn-secondary text-xs py-2 px-4">文本模式</button>
                        </div>
                    </div>

                    <!-- 文本输入 -->
                    <div class="relative mb-6">
                        <textarea id="text" rows="10" class="brut-textarea font-mono text-sm" placeholder="在此输入需要转换的文本..."></textarea>
                        <textarea id="ssml" rows="10" class="brut-textarea font-mono text-sm hidden" placeholder="在此输入 SSML 内容...

示例:
<speak>
  <voice name='zh-CN-XiaoxiaoNeural'>
    你好，<prosody rate='slow'>这是慢速语音</prosody>，
    <prosody pitch='high'>这是高音调</prosody>。
  </voice>
</speak>"></textarea>
                        <div class="absolute bottom-4 right-4 flex items-center gap-2 bg-white px-3 py-1 border-2 border-black rounded-none">
                            <span id="charCount" class="char-count font-black tabular-nums">0</span>
                            <span class="font-bold">/</span>
                            <span class="font-bold">5000</span>
                        </div>
                    </div>

                    <!-- SSML 提示 -->
                    <div id="ssmlHelp" class="hidden mb-6 bg-brut-cyan border-2 border-black rounded-none p-4">
                        <p class="font-black uppercase mb-2">💡 SSML 提示:</p>
                        <ul class="list-disc list-inside space-y-1 text-sm font-medium">
                            <li>使用 &lt;prosody rate="..."&gt; 调整语速</li>
                            <li>使用 &lt;prosody pitch="..."&gt; 调整音调</li>
                            <li>使用 &lt;break time="..."&gt; 添加停顿</li>
                            <li>使用 &lt;emphasis level="..."&gt; 强调文本</li>
                        </ul>
                    </div>

                    <div class="brut-divider"></div>

                    <!-- 语音选择 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="voice" class="block font-black uppercase text-sm mb-3">选择声音</label>
                            <input type="text" id="voiceSearch" class="brut-input text-sm mb-3" placeholder="🔍 搜索声音...">
                            <select id="voice" class="brut-select text-sm">
                                <option value="loading">加载中...</option>
                            </select>
                            <button id="previewVoice" class="brut-btn-cyan w-full mt-3 text-xs py-2" disabled>▶ 预览声音</button>
                        </div>
                        <div>
                            <label for="style" class="block font-black uppercase text-sm mb-3">情感风格</label>
                            <select id="style" class="brut-select text-sm">
                                <option value="general">普通</option>
                            </select>
                            <div id="styleDescription" class="hidden mt-3 text-xs font-medium bg-brut-yellow border-2 border-black rounded-none p-3">
                                选择不同的情感风格来改变语音的表达方式
                            </div>
                        </div>
                    </div>

                    <!-- 语速/音调滑块 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div>
                            <label for="rate" class="block font-black uppercase text-sm mb-3">语速</label>
                            <div class="flex items-center gap-4">
                                <input type="range" id="rate" min="-100" max="100" value="{{.DefaultRate}}" class="flex-1">
                                <span id="rateValue" class="brut-tag-yellow min-w-[70px] text-center">{{.DefaultRate}}%</span>
                            </div>
                        </div>
                        <div>
                            <label for="pitch" class="block font-black uppercase text-sm mb-3">音调</label>
                            <div class="flex items-center gap-4">
                                <input type="range" id="pitch" min="-100" max="100" value="{{.DefaultPitch}}" class="flex-1">
                                <span id="pitchValue" class="brut-tag-pink min-w-[70px] text-center">{{.DefaultPitch}}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 合成按钮 -->
                    <button id="speak" class="brut-btn-primary w-full text-lg py-4 flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                        </svg>
                        <span>立即合成语音</span>
                    </button>
                </div>
            </div>

            <!-- 右侧：结果区 + 监控区 -->
            <div class="space-y-8">
                <!-- 合成结果 -->
                <div id="resultSection" class="hidden">
                    <div class="brut-panel bg-brut-cyan">
                        <h3 class="brut-text-heading text-xl mb-4">合成结果</h3>

                        <!-- 音频播放器 -->
                        <div class="brut-audio-player bg-white mb-4">
                            <audio id="audioPlayer"></audio>
                            <div class="brut-audio-controls">
                                <button id="playPauseBtn" class="brut-audio-button">
                                    <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                    <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20" class="hidden">
                                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                                    </svg>
                                </button>
                                <div class="brut-audio-progress" id="progressBar">
                                    <div class="brut-audio-progress-bar" id="progressBarFill"></div>
                                    <div class="brut-audio-progress-handle" id="progressHandle"></div>
                                </div>
                                <div class="brut-audio-time">
                                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                                </div>
                            </div>
                            <div class="brut-audio-controls">
                                <div class="brut-audio-volume">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                                        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                                    </svg>
                                    <div class="brut-audio-volume-slider" id="volumeSlider">
                                        <div class="brut-audio-volume-bar" id="volumeBar"></div>
                                        <div class="brut-audio-volume-handle" id="volumeHandle"></div>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-black uppercase">速度:</span>
                                    <select id="playbackSpeed" class="brut-input text-xs px-2 py-1">
                                        <option value="0.5">0.5x</option>
                                        <option value="0.75">0.75x</option>
                                        <option value="1" selected>1x</option>
                                        <option value="1.25">1.25x</option>
                                        <option value="1.5">1.5x</option>
                                        <option value="2">2x</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="grid grid-cols-2 gap-3">
                            <button id="download" class="brut-btn-secondary text-xs py-2">📥 下载</button>
                            <button id="copyLink" class="brut-btn-secondary text-xs py-2">🔗 复制</button>
                            <button id="copyHttpTtsLink" class="brut-btn-green text-xs py-2">📖 阅读</button>
                            <button id="copyIfreetimeLink" class="brut-btn-pink text-xs py-2">📚 爱阅记</button>
                        </div>
                    </div>
                </div>

                <!-- 系统监控 -->
                <div class="brut-panel">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="brut-text-heading text-xl">系统监控</h3>
                        <a href="{{.BasePath}}/metrics" target="_blank" class="brut-tag-cyan text-xs">API</a>
                    </div>
                    <div id="metrics-container" class="space-y-3">
                        <div class="brut-kpi-card bg-brut-yellow">
                            <div class="brut-kpi-label">请求总数</div>
                            <div class="brut-kpi-value">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="text-center mt-16 pb-8">
            <div class="flex justify-center items-center gap-4 flex-wrap">
                <a href="{{.BasePath}}/api-doc" class="brut-tag-cyan text-xs hover:shadow-brut-sm hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all">API 文档</a>
                <button id="historyToggle" class="brut-tag-pink text-xs hover:shadow-brut-sm hover:translate-x-[-2px] hover:translate-y-[-2px] transition-all">📜 历史记录</button>
                <span class="brut-tag text-xs">© 2025 TTS</span>
            </div>
        </footer>

    </div>

    <!-- 加载遮罩 -->
    <div id="loadingOverlay" class="brut-loading-overlay">
        <div class="text-center">
            <div class="brut-spinner"></div>
            <div class="brut-loading-text">正在处理中...</div>
        </div>
    </div>

    <!-- 历史记录面板 -->
    <div id="historyPanel" class="brut-history-panel">
        <div class="brut-history-header">
            <h3 class="brut-history-title">历史记录</h3>
            <button id="historyPanelClose" class="brut-history-close">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
        <div id="historyPanelContent" class="brut-history-content">
            <div class="brut-history-empty">暂无历史记录</div>
        </div>
    </div>

    <!-- 快捷键提示 -->
    <div class="brut-shortcut-hint">
        <span class="font-black uppercase text-sm">快捷键:</span>
        <div class="flex gap-2">
            <span class="brut-shortcut-key">Ctrl</span>
            <span class="font-black">+</span>
            <span class="brut-shortcut-key">Enter</span>
            <span class="font-medium text-sm">合成</span>
        </div>
        <div class="flex gap-2">
            <span class="brut-shortcut-key">Ctrl</span>
            <span class="font-black">+</span>
            <span class="brut-shortcut-key">H</span>
            <span class="font-medium text-sm">历史</span>
        </div>
    </div>

    <!-- 提示容器 -->
    <div id="custom-alert-container" class="fixed top-6 right-6 z-50 space-y-3"></div>

</body>
</html>
