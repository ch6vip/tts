function e(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}class t{constructor(e=""){this.basePath=e}async getVoices(){try{const e=await fetch("".concat(this.basePath,"/api/voices"));if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){throw e}}async synthesize(e){try{const t={...e,rate:String(e.rate),pitch:String(e.pitch)},s=await fetch("".concat(this.basePath,"/api/tts"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const e=await s.json();throw new Error(e.error||"HTTP error! status: ".concat(s.status))}const n=await s.blob();return URL.createObjectURL(n)}catch(t){throw t}}async getMetrics(){try{const e=await fetch("".concat(this.basePath,"/metrics"));if(!e.ok)throw new Error("HTTP error! status: ".concat(e.status));const t=await e.text();return this.parseMetrics(t)}catch(e){throw e}}parseMetrics(e){const t={},s=e.split("\n");for(const n of s){if(n.startsWith("#")||!n.trim())continue;const e=n.match(/^(\w+)(?:\{.*?\})?\s+(.+)$/);if(e){const[,s,n]=e;t[s]=parseFloat(n)}}return t}}function s(e){return document.querySelector(e)}function n(e,t={},s=""){const n=document.createElement(e);return Object.entries(t).forEach(([e,t])=>{"className"===e?n.className=t:"style"===e&&"object"==typeof t?Object.assign(n.style,t):e.startsWith("on")&&"function"==typeof t?n.addEventListener(e.slice(2).toLowerCase(),t):n.setAttribute(e,t)}),"string"==typeof s?n.textContent=s:s instanceof Element&&n.appendChild(s),n}function i(e,t,s){e&&e.classList.toggle(t,s)}function o(e){if(!isFinite(e))return"0:00";const t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))}async function a(e){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",document.body.appendChild(s),s.select();try{return document.execCommand("copy"),s.remove(),!0}catch(t){return s.remove(),!1}}}catch(t){return!1}}class l{constructor(){this.audio=null,this.isPlaying=!1,this.elements={},this.init()}init(){this.elements={audio:s("#audioPlayer"),playPauseBtn:s("#playPauseBtn"),playIcon:s("#playIcon"),pauseIcon:s("#pauseIcon"),progressBar:s("#progressBar"),progressBarFill:s("#progressBarFill"),progressHandle:s("#progressHandle"),currentTime:s("#currentTime"),duration:s("#duration"),volumeSlider:s("#volumeSlider"),volumeBar:s("#volumeBar"),volumeHandle:s("#volumeHandle"),playbackSpeed:s("#playbackSpeed"),resultSection:s("#resultSection")},this.elements.audio&&(this.audio=this.elements.audio,this.attachEvents())}attachEvents(){var e,t,s;null==(e=this.elements.playPauseBtn)||e.addEventListener("click",()=>this.togglePlay()),this.audio.addEventListener("loadedmetadata",()=>this.onLoadedMetadata()),this.audio.addEventListener("timeupdate",()=>this.onTimeUpdate()),this.audio.addEventListener("ended",()=>this.onEnded()),null==(t=this.elements.progressBar)||t.addEventListener("click",e=>this.onProgressBarClick(e)),this.initProgressDrag(),this.initVolumeControl(),null==(s=this.elements.playbackSpeed)||s.addEventListener("change",e=>{this.audio.playbackRate=parseFloat(e.target.value)})}load(e){this.audio&&(this.audio.src=e,this.audio.load(),this.show())}togglePlay(){this.audio&&(this.isPlaying?this.pause():this.play())}async play(){if(this.audio)try{await this.audio.play(),this.isPlaying=!0,this.updatePlayPauseIcon()}catch(e){}}pause(){this.audio&&(this.audio.pause(),this.isPlaying=!1,this.updatePlayPauseIcon())}stop(){this.audio&&(this.audio.pause(),this.audio.currentTime=0,this.isPlaying=!1,this.updatePlayPauseIcon())}setVolume(e){this.audio&&(this.audio.volume=Math.max(0,Math.min(1,e)))}seek(e){this.audio&&(this.audio.currentTime=e)}show(){i(this.elements.resultSection,"hidden",!1)}hide(){i(this.elements.resultSection,"hidden",!0)}onLoadedMetadata(){this.elements.duration&&(this.elements.duration.textContent=o(this.audio.duration))}onTimeUpdate(){if(!this.audio)return;const e=this.audio.currentTime,t=this.audio.duration;if(this.elements.currentTime&&(this.elements.currentTime.textContent=o(e)),this.elements.progressBarFill&&this.elements.progressHandle&&t>0){const s=e/t*100;this.elements.progressBarFill.style.width="".concat(s,"%"),this.elements.progressHandle.style.left="".concat(s,"%")}}onEnded(){this.isPlaying=!1,this.updatePlayPauseIcon()}updatePlayPauseIcon(){this.isPlaying?(i(this.elements.playIcon,"hidden",!0),i(this.elements.pauseIcon,"hidden",!1)):(i(this.elements.playIcon,"hidden",!1),i(this.elements.pauseIcon,"hidden",!0))}onProgressBarClick(e){if(!this.audio||!this.elements.progressBar)return;const t=this.elements.progressBar.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;this.seek(this.audio.duration*s)}initProgressDrag(){if(!this.elements.progressHandle)return;let e=!1;this.elements.progressHandle.addEventListener("mousedown",()=>{e=!0}),document.addEventListener("mousemove",t=>{if(!e||!this.elements.progressBar)return;const s=this.elements.progressBar.getBoundingClientRect(),n=Math.max(0,Math.min(t.clientX-s.left,s.width))/s.width;this.seek(this.audio.duration*n)}),document.addEventListener("mouseup",()=>{e=!1})}initVolumeControl(){if(!this.elements.volumeSlider||!this.elements.volumeHandle)return;let e=!1;const t=e=>{const t=this.elements.volumeSlider.getBoundingClientRect(),s=Math.max(0,Math.min(e.clientX-t.left,t.width))/t.width;this.setVolume(s),this.elements.volumeBar.style.width="".concat(100*s,"%"),this.elements.volumeHandle.style.left="".concat(100*s,"%")};this.elements.volumeSlider.addEventListener("click",t),this.elements.volumeHandle.addEventListener("mousedown",()=>{e=!0}),document.addEventListener("mousemove",s=>{e&&t(s)}),document.addEventListener("mouseup",()=>{e=!1}),this.setVolume(1),this.elements.volumeBar.style.width="100%",this.elements.volumeHandle.style.left="100%"}destroy(){this.stop(),this.audio&&(this.audio.src="")}}const r="tts_";function c(e,t){try{const s=JSON.stringify(t);return localStorage.setItem(r+e,s),!0}catch(s){return!1}}function h(e,t=null){try{const s=localStorage.getItem(r+e);return s?JSON.parse(s):t}catch(s){return t}}function u(){return h("formData")}function d(){return h("history",[])}function m(e,t=50){const s=d();e.timestamp=Date.now(),s.unshift(e),s.length>t&&(s.length=t),function(e){c("history",e)}(s)}class p{constructor(e){this.api=e,this.voices=[],this.filteredVoices=[],this.elements={},this.init()}init(){this.elements={voiceSelect:s("#voice"),voiceSearch:s("#voiceSearch"),styleSelect:s("#style"),previewBtn:s("#previewVoice"),styleDescription:s("#styleDescription")},this.attachEvents(),this.loadVoices()}attachEvents(){var e,t,s;if(this.elements.voiceSearch){const e=function(e,t=300){let s=null;return function(...n){clearTimeout(s),s=setTimeout(()=>e.apply(this,n),t)}}(e=>{this.filterVoices(e.target.value)},300);this.elements.voiceSearch.addEventListener("input",e)}null==(e=this.elements.voiceSelect)||e.addEventListener("change",()=>{this.onVoiceChange()}),null==(t=this.elements.styleSelect)||t.addEventListener("change",()=>{this.onStyleChange()}),null==(s=this.elements.previewBtn)||s.addEventListener("click",()=>{this.previewVoice()})}async loadVoices(){try{const e=await this.api.getVoices();this.voices=e.voices||[],this.filteredVoices=[...this.voices],this.renderVoices()}catch(e){this.showError("加载语音列表失败")}}renderVoices(){var e;if(!this.elements.voiceSelect)return;if(this.elements.voiceSelect.innerHTML="",0===this.filteredVoices.length){const e=document.createElement("option");return e.value="",e.textContent="没有找到匹配的语音",void this.elements.voiceSelect.appendChild(e)}this.filteredVoices.forEach(e=>{const t=document.createElement("option");t.value=e.ShortName;const s=e.LocalName||e.DisplayName,n="Female"===e.Gender?"女":"Male"===e.Gender?"男":e.Gender;t.textContent="".concat(s," (").concat(n,")"),this.elements.voiceSelect.appendChild(t)});const t=u(),s=[null==t?void 0:t.voice,null==(e=window.config)?void 0:e.defaultVoice].filter(Boolean);for(const n of s)if(this.elements.voiceSelect.querySelector('option[value="'.concat(CSS.escape(n),'"]'))){this.elements.voiceSelect.value=n;break}this.onVoiceChange(),this.elements.previewBtn&&(this.elements.previewBtn.disabled=!1)}filterVoices(e){if(e.trim()){const t=e.toLowerCase();this.filteredVoices=this.voices.filter(e=>e.DisplayName.toLowerCase().includes(t)||e.LocalName.toLowerCase().includes(t)||e.ShortName.toLowerCase().includes(t))}else this.filteredVoices=[...this.voices];this.renderVoices()}onVoiceChange(){const e=this.getSelectedVoice();e&&this.updateStyles(e)}onStyleChange(){var e;(null==(e=this.elements.styleSelect)?void 0:e.value)&&this.elements.styleDescription&&i(this.elements.styleDescription,"hidden",!1)}getSelectedVoice(){var e;const t=null==(e=this.elements.voiceSelect)?void 0:e.value;return t?this.voices.find(e=>e.ShortName===t):null}updateStyles(e){this.elements.styleSelect&&(this.elements.styleSelect.innerHTML='<option value="general">普通</option>',e.StyleList&&e.StyleList.length>0&&e.StyleList.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=this.getStyleDisplayName(e),this.elements.styleSelect.appendChild(t)}))}getStyleDisplayName(e){return{general:"普通",cheerful:"开朗",sad:"悲伤",angry:"愤怒",fearful:"恐惧",calm:"平静",assistant:"助手",newscast:"新闻播报",customerservice:"客服"}[e]||e}async previewVoice(){this.getSelectedVoice()}showError(e){this.elements.voiceSelect&&(this.elements.voiceSelect.innerHTML='<option value="">'.concat(e,"</option>"))}}const v=new class{constructor(e={}){this.state=e,this.listeners=new Map}getState(e){return e?this.state[e]:this.state}setState(e){const t=[];Object.entries(e).forEach(([e,s])=>{this.state[e]!==s&&(this.state[e]=s,t.push(e))}),t.forEach(e=>{this.notify(e,this.state[e])})}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{var s;null==(s=this.listeners.get(e))||s.delete(t)}}notify(e,t){const s=this.listeners.get(e);s&&s.forEach(e=>e(t))}reset(){this.state={},this.listeners.clear()}}({isSSMLMode:!1,isLoading:!1,voices:[],currentVoice:null,currentStyle:"general",currentAudio:null,isPlaying:!1,history:[],formData:{text:"",ssml:"",voice:"",style:"general",rate:0,pitch:0}});function g(e,t="info",s=3e3){const i=document.getElementById("custom-alert-container");if(!i)return;const o=n("div",{className:"custom-alert custom-alert-".concat(t),style:{opacity:"0",transform:"translateY(-20px)"}}),a=function(e){const t={success:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>',error:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>'};return t[e]||t.info}(t),l=n("span",{className:"custom-alert-icon"});l.innerHTML=a;const r=n("span",{className:"custom-alert-message"},e);o.appendChild(l),o.appendChild(r),i.appendChild(o),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="translateY(0)"}),setTimeout(()=>{o.style.opacity="0",o.style.transform="translateY(-20px)",setTimeout(()=>{i.removeChild(o)},300)},s)}const y=(e,t)=>g(e,"success",t),f=(e,t)=>g(e,"error",t);const S=window.config||{basePath:"",defaultFormat:""};class w{constructor(){this.api=new t(S.basePath),this.audioPlayer=null,this.voiceSelector=null,this.elements={},this.init()}init(){this.initElements(),this.initComponents(),this.initEventListeners(),this.loadSavedFormData(),this.initKeyboardShortcuts(),this.startMetricsPolling()}initElements(){this.elements={textInput:s("#text"),ssmlInput:s("#ssml"),voiceSelect:s("#voice"),styleSelect:s("#style"),rateInput:s("#rate"),rateValue:s("#rateValue"),pitchInput:s("#pitch"),pitchValue:s("#pitchValue"),speakButton:s("#speak"),downloadButton:s("#download"),copyLinkButton:s("#copyLink"),copyHttpTtsLinkButton:s("#copyHttpTtsLink"),copyIfreetimeLinkButton:s("#copyIfreetimeLink"),charCount:s("#charCount"),toggleInputModeBtn:s("#toggleInputMode"),ssmlHelp:s("#ssmlHelp"),loadingOverlay:s("#loadingOverlay"),historyPanel:s("#historyPanel"),historyPanelClose:s("#historyPanelClose"),historyPanelContent:s("#historyPanelContent"),historyToggle:s("#historyToggle"),metricsContainer:s("#metrics-container")}}initComponents(){this.audioPlayer=new l,this.voiceSelector=new p(this.api)}initEventListeners(){var e,t,s,n,i,o,a,l,r,c,h,u;null==(e=this.elements.speakButton)||e.addEventListener("click",()=>this.synthesize()),null==(t=this.elements.downloadButton)||t.addEventListener("click",()=>this.downloadAudio()),null==(s=this.elements.copyLinkButton)||s.addEventListener("click",()=>this.copyLink()),null==(n=this.elements.copyHttpTtsLinkButton)||n.addEventListener("click",()=>this.copyHttpTtsLink()),null==(i=this.elements.copyIfreetimeLinkButton)||i.addEventListener("click",()=>this.copyIfreetimeLink()),null==(o=this.elements.toggleInputModeBtn)||o.addEventListener("click",()=>this.toggleInputMode()),null==(a=this.elements.textInput)||a.addEventListener("input",()=>this.updateCharCount()),null==(l=this.elements.ssmlInput)||l.addEventListener("input",()=>this.updateCharCount()),null==(r=this.elements.rateInput)||r.addEventListener("input",e=>{this.elements.rateValue&&(this.elements.rateValue.textContent="".concat(e.target.value,"%"))}),null==(c=this.elements.pitchInput)||c.addEventListener("input",e=>{this.elements.pitchValue&&(this.elements.pitchValue.textContent="".concat(e.target.value,"%"))}),null==(h=this.elements.historyToggle)||h.addEventListener("click",()=>this.toggleHistoryPanel()),null==(u=this.elements.historyPanelClose)||u.addEventListener("click",()=>this.closeHistoryPanel()),["textInput","ssmlInput","voiceSelect","styleSelect","rateInput","pitchInput"].forEach(e=>{var t;null==(t=this.elements[e])||t.addEventListener("change",()=>this.saveFormData())})}initKeyboardShortcuts(){document.addEventListener("keydown",e=>{e.ctrlKey&&"Enter"===e.key&&(e.preventDefault(),this.synthesize()),e.ctrlKey&&"h"===e.key&&(e.preventDefault(),this.toggleHistoryPanel())})}async synthesize(){const e=this.getFormData(),t=function(e){const t=[];if(e.ssml){const s=function(e){if(!e||0===e.trim().length)return{valid:!1,message:"请输入 SSML 内容"};if(!e.includes("<speak>")||!e.includes("</speak>"))return{valid:!1,message:"SSML 格式错误：缺少 <speak> 标签"};const t=e.match(/<(\w+)[^>]*>/g)||[],s=e.match(/<\/(\w+)>/g)||[];return t.length!==s.length?{valid:!1,message:"SSML 格式错误：标签不匹配"}:{valid:!0,message:""}}(e.ssml);s.valid||t.push(s.message)}else{const s=function(e,t=5e3){return e&&0!==e.trim().length?e.length>t?{valid:!1,message:"文本长度超出限制，最多 ".concat(t," 个字符，当前 ").concat(e.length," 个字符")}:{valid:!0,message:""}:{valid:!1,message:"请输入要转换的文本"}}(e.text);s.valid||t.push(s.message)}const s=(n=e.voice)&&"loading"!==n?{valid:!0,message:""}:{valid:!1,message:"请选择语音"};var n,i,o;return s.valid||t.push(s.message),"number"==typeof(i=e.rate)&&i>=-100&&i<=100||t.push("语速值无效"),"number"==typeof(o=e.pitch)&&o>=-100&&o<=100||t.push("音调值无效"),{valid:0===t.length,errors:t}}(e);if(t.valid){this.setLoading(!0);try{const t=await this.api.synthesize(e);this.audioPlayer.load(t),this.saveToHistory(e,t),v.setState({currentAudio:t}),y("语音合成成功！")}catch(s){f(s.message||"语音合成失败，请稍后重试")}finally{this.setLoading(!1)}}else f(t.errors.join("\n"))}getFormData(){var e,t,s,n,i,o,a,l;const r=v.getState("isSSMLMode"),c=parseInt(null!=(t=null==(e=this.elements.rateInput)?void 0:e.value)?t:"0",10),h=parseInt(null!=(n=null==(s=this.elements.pitchInput)?void 0:s.value)?n:"0",10);return{text:r?"":(null==(i=this.elements.textInput)?void 0:i.value)||"",ssml:r&&(null==(o=this.elements.ssmlInput)?void 0:o.value)||"",voice:(null==(a=this.elements.voiceSelect)?void 0:a.value)||"",style:(null==(l=this.elements.styleSelect)?void 0:l.value)||"general",rate:Number.isFinite(c)?c:0,pitch:Number.isFinite(h)?h:0,format:S.defaultFormat||""}}saveFormData(){const e=this.getFormData();c("formData",e)}loadSavedFormData(){const e=u();e&&(this.elements.textInput&&e.text&&(this.elements.textInput.value=e.text),this.elements.voiceSelect&&e.voice&&(this.elements.voiceSelect.value=e.voice),this.elements.styleSelect&&e.style&&(this.elements.styleSelect.value=e.style),this.elements.rateInput&&void 0!==e.rate&&(this.elements.rateInput.value=e.rate,this.elements.rateValue&&(this.elements.rateValue.textContent="".concat(e.rate,"%"))),this.elements.pitchInput&&void 0!==e.pitch&&(this.elements.pitchInput.value=e.pitch,this.elements.pitchValue&&(this.elements.pitchValue.textContent="".concat(e.pitch,"%"))),this.updateCharCount())}saveToHistory(e,t){m({...e,audioUrl:t,timestamp:Date.now()})}toggleInputMode(){const e=!v.getState("isSSMLMode");v.setState({isSSMLMode:e}),i(this.elements.textInput,"hidden",e),i(this.elements.ssmlInput,"hidden",!e),i(this.elements.ssmlHelp,"hidden",!e),this.elements.toggleInputModeBtn&&(this.elements.toggleInputModeBtn.textContent=e?"SSML模式":"文本模式"),this.updateCharCount()}updateCharCount(){var e,t;if(!this.elements.charCount)return;const s=v.getState("isSSMLMode")?(null==(e=this.elements.ssmlInput)?void 0:e.value)||"":(null==(t=this.elements.textInput)?void 0:t.value)||"";this.elements.charCount.textContent=s.length,s.length>4500?this.elements.charCount.classList.add("danger"):s.length>4e3?this.elements.charCount.classList.add("warning"):this.elements.charCount.classList.remove("danger","warning")}downloadAudio(){const e=v.getState("currentAudio");if(!e)return;const t=document.createElement("a");t.href=e,t.download="tts_".concat(Date.now(),".mp3"),t.click()}async copyLink(){const e=v.getState("currentAudio");if(!e)return;await a(e)?y("链接已复制到剪贴板"):f("复制失败")}async copyHttpTtsLink(){const e=this.getFormData(),t=this.buildHttpTtsUrl(e);await a(t)?y("已复制到剪贴板，可导入「阅读」APP"):f("复制失败")}async copyIfreetimeLink(){const e=this.getFormData(),t=this.buildIfreetimeUrl(e);await a(t)?y("已复制到剪贴板，可导入「爱阅记」APP"):f("复制失败")}buildHttpTtsUrl(e){var t,s;const n=window.location.origin+S.basePath,i=encodeURIComponent(e.voice||"AzureTTS"),o=encodeURIComponent(e.voice||""),a=encodeURIComponent(String(null!=(t=e.rate)?t:"")),l=encodeURIComponent(String(null!=(s=e.pitch)?s:"")),r=encodeURIComponent(e.style||""),c=encodeURIComponent(e.format||""),h=["v=".concat(o),"r=".concat(a),"p=".concat(l),r?"s=".concat(r):"",c?"f=".concat(c):"","n=".concat(i)].filter(Boolean).join("&");return"".concat(n,"/reader.json?").concat(h)}buildIfreetimeUrl(e){var t,s;const n=window.location.origin+S.basePath,i=encodeURIComponent(e.voice||"AzureTTS"),o=encodeURIComponent(e.voice||""),a=encodeURIComponent(String(null!=(t=e.rate)?t:"")),l=encodeURIComponent(String(null!=(s=e.pitch)?s:"")),r=encodeURIComponent(e.style||""),c=encodeURIComponent(e.format||""),h=["v=".concat(o),"r=".concat(a),"p=".concat(l),r?"s=".concat(r):"",c?"f=".concat(c):"","n=".concat(i)].filter(Boolean).join("&");return"".concat(n,"/ifreetime.json?").concat(h)}toggleHistoryPanel(){var e;(null==(e=this.elements.historyPanel)?void 0:e.classList.contains("open"))?this.closeHistoryPanel():this.openHistoryPanel()}openHistoryPanel(){i(this.elements.historyPanel,"open",!0),this.renderHistory()}closeHistoryPanel(){i(this.elements.historyPanel,"open",!1)}renderHistory(){const e=d();if(!this.elements.historyPanelContent)return;if(0===e.length)return void(this.elements.historyPanelContent.innerHTML='<div class="history-empty">暂无历史记录</div>');const t=e.map(e=>'\n      <div class="history-item">\n        <div class="history-item-text">'.concat(this.truncate(e.text||e.ssml,50),'</div>\n        <div class="history-item-meta">\n          <span>').concat(e.voice,"</span>\n          <span>").concat(new Date(e.timestamp).toLocaleString(),"</span>\n        </div>\n      </div>\n    ")).join("");this.elements.historyPanelContent.innerHTML=t}truncate(e,t){return e.length>t?e.substring(0,t)+"...":e}setLoading(e){v.setState({isLoading:e}),i(this.elements.loadingOverlay,"show",e),this.elements.speakButton&&(this.elements.speakButton.disabled=e)}startMetricsPolling(){this.updateMetrics(),setInterval(()=>this.updateMetrics(),3e4)}async updateMetrics(){try{const e=await this.api.getMetrics();this.renderMetrics(e)}catch(e){}}renderMetrics(e){if(!this.elements.metricsContainer)return;const t='\n      <div class="metric-item">\n        <span class="metric-label">请求总数:</span>\n        <span class="metric-value">'.concat(e.tts_requests_total||0,'</span>\n      </div>\n      <div class="metric-item">\n        <span class="metric-label">成功率:</span>\n        <span class="metric-value">').concat(this.calculateSuccessRate(e),'%</span>\n      </div>\n      <div class="metric-item">\n        <span class="metric-label">平均响应时间:</span>\n        <span class="metric-value">').concat((e.tts_request_duration_seconds||0).toFixed(2),"s</span>\n      </div>\n    ");this.elements.metricsContainer.innerHTML=t}calculateSuccessRate(e){const t=e.tts_requests_total||0,s=e.tts_errors_total||0;return 0===t?100:((t-s)/t*100).toFixed(1)}}document.addEventListener("DOMContentLoaded",()=>{window.ttsApp=new w});export{e as __vite_legacy_guard};
